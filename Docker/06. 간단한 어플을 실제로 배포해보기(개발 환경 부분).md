# 간단한 어플을 실제로 배포해보기(개발 환경 부분)
## 도커를 이용하여 개발단계에서 리액트 실행하기
![개발환경의도커파일](https://github.com/haeyonghahn/TIL/blob/master/Docker/images/%EA%B0%9C%EB%B0%9C%ED%99%98%EA%B2%BD%EC%9D%98%EB%8F%84%EC%BB%A4%ED%8C%8C%EC%9D%BC.PNG)

현재까지는 Dockerfile을 한 가지만 만들었지만,    
실제로는 Dockerfile을 개발단계를 위한 것과 운용단계를 위한 것을 따로 작성하는 것이 좋다.

![dockerfiledev](https://github.com/haeyonghahn/TIL/blob/master/Docker/images/dockerfiledev.PNG)

이렇게 Dockerfile.dev 를 작성한 후 도커 파일로 이미지를 생성하면 된다.   
`docker build ./`로 이미지를 생성한다.   

그러나 `unable to evaluate symlink`에러가 발생하는데 그 이유는 원래 이미지를 빌드할 때 해당 디렉토리만 정해주면 `Dockerfile`을 자동으로 찾아서 빌드하는데 현재는 `Dokerfile`이 없고 `Dockerfile.dev`밖에 없기 때문이다. 그렇기 때문에 자동으로 올바른 도커 파일을 찾지 못하여 에러가 발생한다. 해결방법은 임의로 `build`할 때 어떤 파일을 참조할지 알려주는 것이다.
```docker
docker build -f Dockerfile.dev .
```
`-f` : 이미지를 빌드할 때 쓰일 도커파일을 임의로 지정해준다.

## 생성된 도커 이미지로 리액트 실행하기
### 포트매핑
![포트매핑](https://github.com/haeyonghahn/TIL/blob/master/Docker/images/%ED%8F%AC%ED%8A%B8%EB%A7%A4%ED%95%91.PNG)

```docker
docker run -p 3000:3000 <이미지이름>
```
원래는 이렇게 해서 실행되어야하지만 리액트 업그레이드로 인해 `-t`붙여야 실행이 가능하다.

```docker
docker run -it -p 3000:3000 <이미지이름>
```

## 볼륨을 이용한 소스 코드 변경
`COPY`대신에 `VOLUME`을 이용하여 소스를 변경했을 때 다시 이미지를 빌드하지 않아도 변경한 소스 부분이 애플리케이션에 반영된다.

![COPY와VOLUME](https://github.com/haeyonghahn/TIL/blob/master/Docker/images/COPY%EC%99%80VOLUME.PNG)

### VOLUME을 사용해서 어플리케이션 실행 방법
```docker
docker run -p 3000:3000 -v /usr/src/app/node_modules -v $(pwd):/usr/src/app <이미지아이디>
로컬이 mac 환경일 때
예시 : docker run -it -p 3000:3000 -v /usr/src/app/node_modules -v $(pwd):/usr/src/app haeyonghahn/dockerreact-app
로컬이 window 환경일 때
예시 : docker run -it -p 3000:3000 -v /usr/src/app/node_modules -v ${PWD}:/usr/src/app haeyonghahn/dockerreact-app
```
- `-v /usr/src/app/node_modules` : 호스트 디렉토리에 node_modules은 없기에 컨테이너에 맵핑을 하지 말라고 하는 것
- `-v $(pwd):/usr/src/app` : pwd 경로에 있는 디렉토리 혹은 파일을 /usr/src/app 경로에서 참조 
![volume](https://github.com/haeyonghahn/TIL/blob/master/Docker/images/volume.PNG)

## 도커 컴포즈로 좀 더 간단하게 앱 실행해보기
리액트 앱을 실행할 때 긴 명령어가 불편하다. 이러한 불편을 해소하기 위해 도커 COMPOSE를 이용한다.
1. docker-compose.yml 파일 생성
2. docker-compose.yml 파일 작성하기

![reactdockercompose](https://github.com/haeyonghahn/TIL/blob/master/Docker/images/reactdockercompose.PNG)
